# F009 - 課程註冊功能

**狀態:** 已完成  
**優先級:** 高  
**預計完成日期:** 已完成  
**負責人:** 開發團隊

## 1. 功能概述

課程註冊功能允許學生瀏覽及註冊各學期提供的課程，包括查看課程詳情、時間表衝突檢查、學分限制檢查以及繳費資訊管理。系統提供完整的課程選擇、加退選流程，並能即時反映課程註冊狀態。

## 2. 需求規格

### 2.1 功能需求

- 提供課程目錄瀏覽功能，顯示各學期可選課程
- 課程搜尋與篩選功能（按類別、學分、時間等）
- 詳細的課程資訊展示（教師、學分、教室、時間等）
- 課程選擇與加入購物車功能
- 時間表衝突自動檢測與提示
- 學分上限檢查與提示
- 顯示已選課程清單和總學分數
- 課程加退選功能
- 註冊確認與繳費資訊顯示
- 選課結果與狀態追蹤
- 即時顯示課程容量與剩餘名額

### 2.2 相關需求文檔

- 課程註冊頁面實現在 `src/views/Courses/CourseRegistration.vue`
- 課程目錄實現在 `src/views/Courses/CourseCatalog.vue`
- 課程狀態和數據管理在 `src/stores/course.js`
- 模擬數據和處理邏輯在 `src/mocks/domains/courses/`

## 3. 使用者故事

**作為** 神學院學生，  
**我希望** 能夠瀏覽所有可選的課程及其詳細資訊，  
**以便** 根據我的學習需求選擇合適的課程。

**作為** 註冊學生，  
**我希望** 系統能自動檢測時間衝突和學分限制，  
**以便** 避免選擇不可行的課程組合。

**作為** 註冊學生，  
**我希望** 能夠查看我的選課歷史和當前狀態，  
**以便** 掌握我的學習進度和計劃。

**作為** 教務處職員，  
**我希望** 獲取實時的選課數據和統計資訊，  
**以便** 合理分配教室資源和調整課程安排。

## 4. 流程設計

### 4.1 業務流程

1. 學生登入系統
2. 瀏覽當學期課程目錄
3. 搜尋和篩選感興趣的課程
4. 查看詳細課程資訊
5. 將課程加入選課列表
6. 系統檢查時間衝突和學分限制
7. 確認選課結果
8. 生成繳費資訊
9. 完成註冊流程
10. 查看選課結果和狀態

### 4.2 使用流程

**學生選課過程：**

1. 進入課程目錄頁面
2. 使用搜索或篩選找到目標課程
3. 點擊課程查看詳細資訊
4. 點擊「加入選課列表」按鈕
5. 在選課列表中查看已選課程
6. 可從選課列表中移除不需要的課程
7. 確認選課列表後提交註冊申請
8. 查看註冊確認結果和繳費資訊

**加退選流程：**

1. 進入已選課程頁面
2. 查看當前已註冊課程
3. 點擊「退選」按鈕退掉不需要的課程
4. 返回課程目錄繼續選擇新課程
5. 系統即時更新選課狀態和學分統計

### 4.3 狀態轉換

- 可選 -> 已選：學生將課程加入選課列表
- 已選 -> 可選：學生從選課列表移除課程
- 已選 -> 已註冊：學生確認選課並完成繳費
- 已註冊 -> 已退選：學生在加退選期間退掉課程
- 可選 -> 已滿：課程報名人數達到上限

## 5. 技術設計

### 5.1 架構設計

課程註冊功能基於 Vue 3 + Pinia 實現：

- 前端使用 Vue 3 和 Ant Design Vue 構建界面
- 使用 Pinia 進行課程數據和選課狀態管理
- 使用 Vue Router 處理頁面導航和查詢參數
- 使用表格組件展示課程列表，支持排序和篩選
- 使用 sessionStorage 在測試環境中暫存選課數據

### 5.2 數據模型

```
// 課程數據模型
course: {
  id: String,                  // 課程編號
  code: String,                // 課程代碼
  name: String,                // 課程名稱
  credits: Number,             // 學分數
  instructor: String,          // 授課教師
  term: String,                // 學期 (如 2023-Fall)
  category: String,            // 課程類別 (必修/選修)
  department: String,          // 開課部門
  description: String,         // 課程描述
  prerequisites: Array,        // 先修課程列表
  schedule: Array,             // 上課時間表 [{ day, startTime, endTime, room }]
  capacity: Number,            // 課程容量
  enrolled: Number,            // 已註冊人數
  status: String,              // 課程狀態 (開放/已滿/已關閉)
  syllabus: String,            // 課程大綱連結
}

// 學生選課數據模型
courseRegistration: {
  studentId: String,           // 學生ID
  term: String,                // 學期
  registeredCourses: Array,    // 已註冊課程ID列表
  waitlistCourses: Array,      // 候補課程ID列表
  totalCredits: Number,        // 總學分數
  registrationDate: String,    // 註冊日期
  status: String,              // 註冊狀態 (暫存/已確認/已繳費)
  paymentInfo: Object,         // 繳費資訊
}
```

### 5.3 API 設計

在目前實現中，前端使用模擬數據，未來可擴展為以下 API：

| 方法 | 路徑                     | 描述             | 參數                 | 返回值             |
| ---- | ------------------------ | ---------------- | -------------------- | ------------------ |
| GET  | `/courses`               | 獲取課程列表     | term, filters        | 課程列表           |
| GET  | `/course/:id`            | 獲取課程詳情     | id                   | 課程詳細資訊       |
| GET  | `/student/registrations` | 獲取學生選課記錄 | studentId, term      | 學生選課記錄       |
| POST | `/course/register`       | 註冊課程         | studentId, courseIds | 註冊結果           |
| POST | `/course/drop`           | 退選課程         | studentId, courseId  | 退選結果           |
| POST | `/course/confirmation`   | 確認選課         | studentId, term      | 確認結果和繳費資訊 |
| GET  | `/course/conflicts`      | 檢查課程衝突     | courseIds            | 衝突詳情           |

### 5.4 依賴關係

- 依賴 `src/stores/course.js` 進行課程數據管理
- 依賴 `src/stores/user.js` 獲取學生資訊
- 依賴 Ant Design Vue 提供表格、表單和其他 UI 組件
- 依賴 `src/mocks/domains/courses/` 提供模擬數據和處理邏輯
- 依賴 `src/utils/scheduleUtils.js` 處理時間表和衝突檢測

## 6. UI/UX 設計

### 6.1 頁面設計

- 課程目錄頁面採用表格布局，顯示所有可選課程
- 課程詳情使用模態框或側邊面板展示完整資訊
- 選課列表使用卡片式布局，直觀顯示已選課程
- 使用標籤頁分離「課程目錄」和「已選課程」視圖
- 頁面頂部有搜尋框和篩選條件
- 頁面底部有學分統計和操作按鈕

### 6.2 交互設計

- 課程表格支持多條件排序和篩選
- 點擊課程行展開顯示更多詳情
- 「加入選課」和「移除課程」按鈕具有明確的視覺反饋
- 時間衝突自動檢測並以紅色標示
- 學分超過上限時顯示警告提示
- 課程容量接近或已滿時有顏色指示
- 選課確認前顯示摘要頁面作為最後檢查

### 6.3 頁面元素

- 課程搜尋框和高級篩選面板
- 課程列表表格，包含分頁功能
- 課程詳情卡片或彈出框
- 已選課程列表
- 學分統計區域
- 時間表視圖（以週為單位的視覺化課表）
- 操作按鈕（加入、移除、確認選課等）
- 狀態指示器（滿員、低容量警告等）

## 7. 測試計劃

### 7.1 測試策略

- 前端單元測試：驗證課程列表和選課邏輯
- 時間衝突檢測測試：確保系統能正確識別衝突
- 學分限制檢查測試：確保系統能正確提示超出學分限制
- 狀態管理測試：確保 Pinia store 正確處理課程數據
- 整合測試：驗證選課流程的完整性
- 使用者測試：確保界面易於使用和理解

### 7.2 測試案例

| 測試 ID | 測試描述       | 測試步驟                                        | 期望結果                       | 前置條件               |
| ------- | -------------- | ----------------------------------------------- | ------------------------------ | ---------------------- |
| TC001   | 課程搜尋測試   | 1. 輸入課程關鍵字<br>2. 點擊搜尋按鈕            | 顯示符合關鍵字的課程           | 訪問課程目錄頁面       |
| TC002   | 課程篩選測試   | 1. 選擇特定學分和類別<br>2. 應用篩選條件        | 只顯示符合條件的課程           | 訪問課程目錄頁面       |
| TC003   | 時間衝突測試   | 1. 選擇兩門時間衝突的課程                       | 系統顯示衝突警告並標記衝突課程 | 已選擇至少一門課程     |
| TC004   | 學分上限測試   | 1. 選擇超過學分上限的課程                       | 系統顯示學分超出警告           | 已選擇接近學分上限課程 |
| TC005   | 課程加退選測試 | 1. 選擇一門課程<br>2. 確認選課<br>3. 退選該課程 | 課程成功加入後再成功退選       | 訪問課程目錄頁面       |

## 8. 開發計劃

### 8.1 工作拆分

| 任務               | 估算時間 | 負責人   |
| ------------------ | -------- | -------- |
| 課程目錄頁面設計   | 已完成   | 開發團隊 |
| 選課列表實現       | 已完成   | 開發團隊 |
| 課程搜尋和篩選功能 | 已完成   | 開發團隊 |
| 時間衝突檢測實現   | 已完成   | 開發團隊 |
| 學分限制檢查       | 已完成   | 開發團隊 |
| Pinia store 實現   | 已完成   | 開發團隊 |
| 選課確認流程       | 已完成   | 開發團隊 |
| 課程時間表視圖     | 已完成   | 開發團隊 |
| 模擬數據設計       | 已完成   | 開發團隊 |
| 整體功能測試       | 已完成   | 開發團隊 |

### 8.2 里程碑

| 日期   | 里程碑                 |
| ------ | ---------------------- |
| 已完成 | 課程目錄瀏覽功能       |
| 已完成 | 課程搜尋和篩選功能     |
| 已完成 | 選課和退選功能         |
| 已完成 | 時間衝突與學分檢查功能 |
| 已完成 | 課程時間表視圖         |
| 已完成 | 選課確認和狀態管理     |
| 已完成 | 整合測試和功能完善     |

## 9. 狀態追蹤

### 9.1 開發進度

課程註冊功能已完成並整合到系統中。

### 9.2 問題記錄

| 日期 | 問題描述 | 狀態 | 解決方案 |
| ---- | -------- | ---- | -------- |
| -    | -        | -    | -        |

## 10. 備註

- 目前課程數據儲存在前端 sessionStorage，實際上線後需要整合後端 API
- 未來可考慮實現課程預選功能，讓學生在正式選課前可以創建和保存選課計劃
- 可增加課程評價和推薦功能，幫助學生做出更好的選擇
- 考慮增加選課優先級處理，處理熱門課程的選課優先順序
- 可實現選課提醒功能，在選課開始前通知學生
- 未來可增加導師預批准功能，某些課程需要導師批准才可選修
