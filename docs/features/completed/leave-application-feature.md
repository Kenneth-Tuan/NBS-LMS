# F007 - 請假申請功能

**狀態:** 已完成  
**優先級:** 高  
**預計完成日期:** 已完成  
**負責人:** 開發團隊

## 1. 功能概述

請假申請功能允許學生提交請假申請，包括請假時間、原因和相關證明材料。系統會記錄申請並提供申請狀態追蹤，管理員可審核批准或駁回這些申請。

## 2. 需求規格

### 2.1 功能需求

- 提供直觀的請假申請表單，收集學生資料和請假相關資訊
- 支持選擇請假起訖日期
- 允許學生描述請假原因
- 支持上傳相關證明材料（如醫療證明）
- 表單提交前進行資料驗證，確保必填欄位完整
- 提交後生成唯一申請編號，便於追蹤
- 顯示申請提交成功的確認消息
- 狀態追蹤功能，顯示申請是否已審核、通過或駁回

### 2.2 相關需求文檔

- 請假申請表單實現在 `src/views/Applications/LeaveApplication.vue`
- 申請狀態和數據管理在 `src/stores/application.js`
- 模擬數據和處理邏輯在 `src/mocks/domains/applications/`

## 3. 使用者故事

**作為** 神學院學生，  
**我希望** 能夠線上提交請假申請，  
**以便** 獲得院方批准暫時離開課程或活動。

**作為** 申請學生，  
**我希望** 能夠上傳相關證明材料，  
**以便** 支持我的請假理由。

**作為** 管理員，  
**我希望** 能夠審核請假申請並查看相關證明，  
**以便** 做出合適的批准或駁回決定。

## 4. 流程設計

### 4.1 業務流程

1. 學生登入系統
2. 學生訪問請假申請頁面
3. 填寫申請表單，包括個人資訊和請假詳情
4. 上傳相關證明材料（如有需要）
5. 系統驗證表單資料
6. 提交申請並獲得唯一申請編號
7. 管理員審核申請
8. 學生可查看申請狀態和結果

### 4.2 使用流程

**學生提交申請：**

1. 進入請假申請頁面
2. 填寫個人基本資料（姓名、學號、聯絡方式）
3. 選擇請假起始和結束日期
4. 填寫請假原因
5. 上傳證明材料（如有需要）
6. 提交申請並接收確認訊息

**管理員審核：**

1. 查看待審核的請假申請
2. 審閱申請詳情和證明材料
3. 批准或駁回申請
4. 提供審核意見（如有必要）

### 4.3 狀態轉換

- 新申請 -> 待審核：學生提交申請後
- 待審核 -> 已通過：管理員批准申請
- 待審核 -> 已駁回：管理員駁回申請

## 5. 技術設計

### 5.1 架構設計

請假申請功能基於 Vue 3 + Pinia 實現：

- 前端使用 Vue 3 和 Ant Design Vue 構建表單界面
- 使用 Pinia 進行狀態管理和表單數據處理
- 使用 Vue Mask 處理特定格式的輸入（如日期）
- 使用檔案上傳組件處理證明材料
- 使用 sessionStorage 在測試環境中暫存申請數據

### 5.2 數據模型

```
// 請假申請數據模型
leaveApplication: {
  id: String,                  // 申請編號 (格式: LEA-YYYY-NNN)
  type: String,                // 申請類型 ("leave")
  name: String,                // 申請者姓名
  studentId: String,           // 學號
  email: String,               // 電子郵件
  tel: String,                 // 電話號碼
  applicationDate: String,     // 申請日期 (YYYY/MM/DD)
  leaveStartDate: String,      // 請假開始日期 (YYYY/MM/DD)
  leaveEndDate: String,        // 請假結束日期 (YYYY/MM/DD)
  leaveReason: String,         // 請假原因
  supportingDocuments: Array,  // 證明材料文件列表
  status: Number,              // 申請狀態 (0: 待審核, 1: 已通過, 2: 已駁回)
  reviewDate: String,          // 審核日期 (YYYY/MM/DD)
  reviewer: String             // 審核者
}
```

### 5.3 API 設計

在目前實現中，前端使用模擬數據，未來可擴展為以下 API：

| 方法 | 路徑                       | 描述         | 參數                   | 返回值       |
| ---- | -------------------------- | ------------ | ---------------------- | ------------ |
| POST | `/application`             | 提交申請     | 申請表單數據           | 申請結果     |
| POST | `/uploadDocument`          | 上傳文件     | 文件數據               | 文件訪問 URL |
| GET  | `/applicationList`         | 獲取申請列表 | 無                     | 申請列表     |
| PUT  | `/updateApplicationStatus` | 更新申請狀態 | id, status, reviewData | 更新結果     |

### 5.4 依賴關係

- 依賴 `src/stores/application.js` 進行申請狀態管理
- 依賴 Ant Design Vue 提供表單和上傳組件
- 依賴 `src/mocks/domains/applications/` 提供模擬數據和處理邏輯
- 依賴 Vue Mask 處理日期輸入格式

## 6. UI/UX 設計

### 6.1 頁面設計

- 表單採用清晰的分組結構，使用卡片式布局
- 個人資料與請假資訊分區，使用分隔線明確區分
- 表單頂部有清晰的標題「請假申請」
- 底部提供提交和重置按鈕

### 6.2 交互設計

- 輸入欄位提供即時驗證反饋
- 必填欄位標記清晰
- 日期選擇器提供直觀的日期範圍選擇
- 文件上傳區塊提供拖放或點擊上傳功能
- 上傳完成後顯示文件預覽和刪除選項
- 提交按鈕在處理過程中顯示載入狀態
- 提交成功後顯示確認對話框，包含申請編號

### 6.3 頁面元素

- 個人資料輸入欄位（姓名、學號、電子郵件、電話）
- 請假時間選擇器（開始日期、結束日期）
- 請假原因多行文本輸入
- 證明文件上傳組件
- 提交和重置按鈕
- 成功提示對話框

## 7. 測試計劃

### 7.1 測試策略

- 前端單元測試：驗證表單組件和校驗邏輯
- 文件上傳測試：確保文件可正確上傳和預覽
- 狀態管理測試：確保 Pinia store 正確處理申請數據
- 整合測試：驗證表單提交和狀態更新流程
- 使用者測試：確保表單易於理解和填寫

### 7.2 測試案例

| 測試 ID | 測試描述         | 測試步驟                               | 期望結果                       | 前置條件         |
| ------- | ---------------- | -------------------------------------- | ------------------------------ | ---------------- |
| TC001   | 表單校驗測試     | 1. 不填寫必填欄位<br>2. 點擊提交按鈕   | 顯示錯誤提示，阻止提交         | 訪問請假申請頁面 |
| TC002   | 成功提交測試     | 1. 填寫所有必填欄位<br>2. 點擊提交按鈕 | 顯示成功提示，包含唯一申請編號 | 訪問請假申請頁面 |
| TC003   | 文件上傳測試     | 1. 點擊上傳區域<br>2. 選擇文件上傳     | 文件成功上傳並顯示預覽         | 訪問請假申請頁面 |
| TC004   | 日期選擇測試     | 1. 選擇開始日期晚於結束日期            | 顯示日期錯誤提示               | 訪問請假申請頁面 |
| TC005   | 申請狀態查看測試 | 1. 提交申請<br>2. 前往申請紀錄頁面     | 能看到已提交的申請及其當前狀態 | 已有已提交的申請 |

## 8. 開發計劃

### 8.1 工作拆分

| 任務             | 估算時間 | 負責人   |
| ---------------- | -------- | -------- |
| 表單 UI 設計     | 已完成   | 開發團隊 |
| 表單驗證邏輯     | 已完成   | 開發團隊 |
| 文件上傳功能     | 已完成   | 開發團隊 |
| Pinia store 實現 | 已完成   | 開發團隊 |
| 申請狀態管理     | 已完成   | 開發團隊 |
| 模擬數據設計     | 已完成   | 開發團隊 |
| 表單提交功能     | 已完成   | 開發團隊 |
| 整體功能測試     | 已完成   | 開發團隊 |

### 8.2 里程碑

| 日期   | 里程碑             |
| ------ | ------------------ |
| 已完成 | 表單界面設計和實現 |
| 已完成 | 文件上傳功能實現   |
| 已完成 | 資料驗證和提交功能 |
| 已完成 | 申請狀態管理和紀錄 |
| 已完成 | 整合測試和功能完善 |

## 9. 狀態追蹤

### 9.1 開發進度

請假申請功能已完成並整合到系統中。

### 9.2 問題記錄

| 日期 | 問題描述 | 狀態 | 解決方案 |
| ---- | -------- | ---- | -------- |
| -    | -        | -    | -        |

## 10. 備註

- 目前申請數據儲存在前端 sessionStorage，實際上線後需要整合後端 API
- 目前文件上傳實際上只是模擬處理，未來需要實現真實的文件存儲機制
- 考慮增加請假類型分類（如病假、事假、喪假等）
- 未來可考慮增加向課程教師自動通知功能
