# F001 - 管理者使用者管理

**狀態:** 待開發  
**優先級:** 高  
**預計完成日期:** YYYY-MM-DD  
**負責人:** TBD

## 1. 功能概述

此功能允許具有管理權限的用戶管理系統中的所有用戶帳號，包括新增、編輯、刪除和查詢用戶，以及管理員權限分級。該功能確保系統用戶資料的正確管理和維護，同時保證對敏感操作的權限控制。

## 2. 需求規格

### 2.1 功能需求

- 支援管理員權限分級（Admin 和 Manager 權限區分）
- 允許新增、編輯、刪除用戶帳號
- 提供用戶查詢和過濾功能
- 記錄用戶操作日誌
- 支援批量導入用戶
- 軟刪除機制
- 用戶密碼管理和安全規則

### 2.2 相關需求文檔

- [Admin_Spec.md](../../../Specs/Admin_Spec.md)
- [TODO.md](../../../TODO.md) - "管理者需要有權限增加或刪除使用帳號"

## 3. 使用者故事

**作為** 系統管理員(Admin)，  
**我希望** 能夠創建、編輯和刪除任何用戶帳號，  
**以便** 維護系統用戶數據的完整性和安全性。

**作為** 系統管理員(Admin)，  
**我希望** 能夠管理其他管理員帳號，  
**以便** 分配適當的系統管理工作。

**作為** 經理級管理員(Manager)，  
**我希望** 能夠管理非管理員的用戶帳號，  
**以便** 處理日常用戶資料的維護。

**作為** 管理員，  
**我希望** 能夠查詢和過濾用戶資料，  
**以便** 快速找到需要處理的用戶帳號。

## 4. 流程設計

### 4.1 業務流程

#### 新增用戶流程

1. 管理員選擇"新增用戶"功能
2. 系統檢查管理員權限
3. 管理員填寫用戶資料表單
4. 系統驗證資料（包括用戶名唯一性、密碼規則等）
5. 系統創建用戶帳號
6. 系統記錄操作日誌

#### 編輯用戶流程

1. 管理員從用戶列表選擇用戶
2. 系統檢查管理員權限
3. 管理員修改用戶資料
4. 系統驗證資料
5. 系統更新用戶帳號
6. 系統記錄操作日誌

#### 刪除用戶流程

1. 管理員選擇用戶
2. 系統檢查管理員權限
3. 管理員確認刪除並填寫原因
4. 系統軟刪除用戶（標記為已刪除但保留數據）
5. 系統記錄操作日誌

### 4.2 使用流程

1. 管理員登入系統
2. 導航至"用戶管理"頁面
3. 系統顯示用戶列表
4. 管理員可以：
   - 使用搜索和過濾功能查找用戶
   - 選擇新增、編輯或刪除操作
   - 查看用戶操作日誌

### 4.3 狀態轉換

用戶帳號狀態轉換：

- 新建 -> 啟用
- 啟用 -> 停用
- 停用 -> 啟用
- 啟用/停用 -> 已刪除

## 5. 技術設計

### 5.1 架構設計

使用前端-後端分離架構：

- 前端：Vue.js + Ant Design Vue 組件
- 後端：Appwrite 服務
- 資料存儲：Appwrite Database

### 5.2 數據模型

```javascript
// User模型
{
  id: String,           // 唯一識別碼
  username: String,     // 用戶名（學號/工號）
  name: String,         // 姓名
  email: String,        // 電子郵件
  password: String,     // 加密密碼
  role: Enum,           // 角色：ADMIN, MANAGER, TEACHER, STUDENT
  phone: String,        // 聯絡電話（選填）
  notes: String,        // 備註（選填）
  status: Enum,         // 狀態：ACTIVE, INACTIVE, DELETED
  createdAt: Timestamp, // 創建時間
  updatedAt: Timestamp, // 更新時間
  lastLoginAt: Timestamp, // 最後登入時間
  createdBy: String,    // 創建人ID
  updatedBy: String     // 更新人ID
}

// 操作日誌模型
{
  id: String,           // 唯一識別碼
  userId: String,       // 操作人ID
  action: String,       // 操作類型
  targetId: String,     // 操作對象ID
  details: Object,      // 操作詳情
  ipAddress: String,    // IP地址
  timestamp: Timestamp  // 操作時間
}
```

### 5.3 API 設計

#### 5.3.1 API 端點

| 方法   | 路徑                | 描述         | 參數                | 返回值         |
| ------ | ------------------- | ------------ | ------------------- | -------------- |
| GET    | `/api/users`        | 獲取用戶列表 | page, limit, filter | 用戶列表、總數 |
| GET    | `/api/users/:id`    | 獲取單個用戶 | id                  | 用戶詳情       |
| POST   | `/api/users`        | 創建用戶     | 用戶資料            | 創建結果       |
| PUT    | `/api/users/:id`    | 更新用戶     | id, 更新資料        | 更新結果       |
| DELETE | `/api/users/:id`    | 刪除用戶     | id, 刪除原因        | 刪除結果       |
| POST   | `/api/users/import` | 批量導入用戶 | Excel 文件          | 導入結果       |
| GET    | `/api/logs`         | 獲取操作日誌 | page, limit, filter | 日誌列表、總數 |

#### 5.3.2 數據流

1. 前端表單收集用戶數據
2. 通過 API 將數據發送到後端
3. 後端驗證數據並處理業務邏輯
4. 後端更新數據庫
5. 後端記錄操作日誌
6. 後端返回結果到前端
7. 前端更新 UI 顯示

### 5.4 依賴關係

- 依賴 Appwrite 認證系統
- 依賴權限控制模塊
- 依賴日誌服務

## 6. UI/UX 設計

### 6.1 頁面設計

主要頁面：

1. 用戶管理列表頁
2. 用戶新增/編輯表單頁
3. 用戶詳情頁
4. 操作日誌頁

### 6.2 交互設計

用戶管理列表頁：

- 頂部搜索和過濾區
- 功能按鈕：新增、批量導入、導出
- 用戶列表表格，支持排序和分頁
- 每行操作按鈕：編輯、刪除、查看詳情

用戶表單頁：

- 分區表單布局
- 表單驗證和錯誤提示
- 提交和取消按鈕

### 6.3 頁面元素

用戶列表頁主要元素：

- 搜索框
- 過濾下拉框
- 表格
- 分頁控件
- 操作按鈕

## 7. 測試計劃

### 7.1 測試策略

- 單元測試：API 和業務邏輯
- 整合測試：前後端數據交互
- 權限測試：不同角色的操作權限
- 表單驗證測試：數據輸入規則
- 用戶體驗測試：操作流程順暢度

### 7.2 測試案例

| 測試 ID | 測試描述           | 測試步驟                                         | 期望結果                     | 前置條件          |
| ------- | ------------------ | ------------------------------------------------ | ---------------------------- | ----------------- |
| TC001   | Admin 創建用戶     | 1. 以 Admin 身份登入<br>2. 創建各種角色用戶      | 成功創建用戶                 | 具有 Admin 權限   |
| TC002   | Manager 創建管理員 | 1. 以 Manager 身份登入<br>2. 嘗試創建 Admin 用戶 | 操作被拒絕                   | 具有 Manager 權限 |
| TC003   | 密碼規則驗證       | 輸入不符合規則的密碼                             | 顯示密碼規則錯誤提示         | N/A               |
| TC004   | 軟刪除機制         | 刪除用戶後檢查數據庫                             | 用戶被標記為已刪除但數據保留 | 存在可刪除用戶    |

## 8. 開發計劃

### 8.1 工作拆分

| 任務         | 估算時間 | 負責人 |
| ------------ | -------- | ------ |
| 數據模型設計 | 1 天     | TBD    |
| API 開發     | 3 天     | TBD    |
| 前端列表頁面 | 2 天     | TBD    |
| 前端表單頁面 | 2 天     | TBD    |
| 權限控制     | 1 天     | TBD    |
| 日誌功能     | 1 天     | TBD    |
| 測試與修復   | 2 天     | TBD    |

### 8.2 里程碑

| 日期       | 里程碑              |
| ---------- | ------------------- |
| YYYY-MM-DD | 完成 API 設計和開發 |
| YYYY-MM-DD | 完成前端頁面開發    |
| YYYY-MM-DD | 完成測試和修復      |

## 9. 狀態追蹤

### 9.1 開發進度

待開始

### 9.2 問題記錄

| 日期 | 問題描述 | 狀態 | 解決方案 |
| ---- | -------- | ---- | -------- |
| -    | -        | -    | -        |

## 10. 備註

- 需考慮將來可能的國際化需求
- 考慮將來與其他系統的整合
- 應注意用戶數據的安全和隱私保護
